# 增强版 Webnovel 阅读器内容提取工具 (含自动滚动)

一套浏览器内的 JavaScript 工具，用于自动滚动加载并提取 Webnovel 故事页面的所有章节内容。最终输出一个干净、格式化的 `.txt` 文本文件，方便离线阅读。

---

## ✅ 工具特性

### 📜 自动滚动工具 (`autoScrollToBottom.js`)
-   自动向下滚动网页，以加载所有通过动态加载（懒加载/无限滚动）显示的章节。
-   在滚动过程中，会在浏览器控制台提供进度反馈。
-   当检测到没有新内容加载时（或达到加载尝试上限时）自动停止。

### 📥 章节提取工具 (`extractAndDownloadAllChapters.js`)
-   从由 `.chapter_content` 类标记的容器中提取每个章节的内容。
-   尝试从 `.cha-tit h1` 元素中提取并使用网页上**实际的章节标题**。
    -   如果未能找到特定标题，则会使用通用的 "Chapter X" 格式作为后备。
-   自动格式化内容：
    -   章节标题：大写，并有清晰的分隔符。
    -   章节正文：段首缩进，优化间距，提高可读性。
-   导出一个 `.txt` 文件，文件名会尝试根据第一章的标题动态生成（如果失败则默认为 `allChaptersText.txt`）。
-   无需安装任何软件 — 直接通过浏览器的开发者工具控制台运行。

---

## 📘 使用说明

整个过程分为两个主要部分，使用两个独立的脚本。**请严格按照顺序执行，并确保每个脚本都已完整定义后再运行。**

您需要从本仓库下载以下两个 JavaScript 文件：
* `autoScrollToBottom.js` (自动滚动脚本)
* `extractAndDownloadAllChapters.js` (章节提取脚本)

---

### **第一部分：自动滚动以加载所有章节**

**重要提示：** 如果目标 Webnovel 页面章节很多，并且内容是随着页面向下滚动而动态加载的，那么**必须先执行此步骤**。如果章节内容已经一次性全部加载，则可以跳过此部分。

1.  **打开目标网页**
    * 在你的浏览器中，打开你想要下载内容的 Webnovel 故事页面。请确保是包含章节内容的主阅读页面。

2.  **打开开发者工具**
    * 在页面任意位置点击鼠标右键。
    * 在弹出的菜单中选择 **“检查”** (Inspect) 或类似选项。
    * 在打开的开发者工具面板中，切换到 **“控制台”** (Console) 标签页。
    * *(快捷键参考：Windows/Linux 上通常是 `Ctrl + Shift + I` 或者为 `F12`，Mac 上通常是 `Cmd + Option + I`)*

3.  **粘贴并定义“自动滚动脚本”**
    * 打开你下载的 `autoScrollToBottom.js` 文件。
    * **复制该文件中的全部代码内容。**
    * 将复制的代码粘贴到浏览器的“控制台”中。
    * 按下 **Enter** 键。这步操作是为了让浏览器“学习”并记住这个函数。控制台可能会显示 `undefined`，这是正常的。

4.  **运行“自动滚动脚本”**
    * 在“控制台”中，输入以下需要**手动键入的命令**来调用刚刚定义的函数：
        ```
        autoScrollToBottom();
        ```
    * 按下 **Enter** 键。
    * 此时，页面应该会开始自动向下滚动。同时观察控制台的输出信息，它会显示页面高度的变化和检测状态。
    * **请耐心等待**，直到控制台输出 “自动滚动结束。页面内容应该已全部（或已达到加载上限）加载完毕。” 的信息。对于章节非常多的故事，这个过程可能会花费几分钟甚至更长时间。
    * **在滚动完成之前，请不要进行下一步操作。**

---

### **第二部分：提取并下载已加载的章节内容**

当“自动滚动脚本”执行完毕（或者你手动滚动加载完所有内容后），并且所有（或你需要的）章节都已加载到页面上之后，执行以下步骤：

5.  **确保开发者工具的“控制台”仍然打开。**

6.  **粘贴并定义“章节提取脚本”**
    * 打开你下载的 `extractAndDownloadAllChapters.js` 文件。
    * **复制该文件中的全部代码内容。**
    * 将复制的代码粘贴到浏览器的“控制台”中。
    * 按下 **Enter** 键。这同样是为了定义函数。控制台也可能显示 `undefined`。

7.  **运行“章节提取脚本”**
    * 在“控制台”中，输入以下需要**手动键入的命令**：
        ```
        extractAndDownloadAllChapters();
        ```
    * 按下 **Enter** 键。
    * 脚本会开始处理页面上所有已加载的章节内容，并在完成后自动触发一个 `.txt` 文件的下载。文件名可能是根据第一章标题生成的（例如 `chapter-1-episode-1....txt`）或默认为 `allChaptersText.txt`。

---

## ⚠️ 重要提示

* **关于调试器暂停：** 如果在运行脚本时，浏览器在“调试程序”(Debugger) 或 “源代码”(Sources) 面板中暂停了，请检查：
    * 是否不小心在控制台或粘贴的代码中留下了 `debugger;` 语句。
    * 开发者工具“源代码”面板中的“异常时暂停”设置（通常是一个带有暂停符号的图标🛑），尝试将其设置为“不暂停”或取消勾选相关选项。
    * 是否有任何活动的“断点”(Breakpoints)，尝试禁用或移除它们。
* **选择器的依赖性：** “章节提取脚本”的有效性高度依赖于 Webnovel 网站页面的 HTML 结构。如果网站更新了其代码结构，脚本中用于定位章节容器 (`.chapter_content`)、章节标题 (`.cha-tit h1` 等) 和段落 (`.cha-words p`) 的选择器可能需要随之调整才能继续工作。
* **自动滚动脚本的参数：** `autoScrollToBottom.js` 脚本内部有 `SCROLL_INTERVAL`（滚动间歇时间）和 `MAX_NO_CHANGE_COUNT`（无内容加载的检测次数上限）参数。如果发现自动滚动过早停止，或者检测结束的过程过长，你可能需要根据具体网站的加载速度在脚本代码中微调这些值。
* **脚本的顺序执行：** **务必**确保自动滚动过程（第一部分）**完全结束**后，再执行章节提取脚本（第二部分）。
* **浏览器和标签页状态：** 在脚本（尤其是自动滚动脚本）运行时，建议保持浏览器标签页处于**活动和可见**状态，因为某些浏览器可能会限制后台标签页的脚本执行效率。
* **组合使用（可选但推荐）：** 如果你不想分两步调用函数，可以在定义完两个函数后（即分别将 `autoScrollToBottom.js` 和 `extractAndDownloadAllChapters.js` 的内容粘贴到控制台并按 Enter 后），使用以下命令来运行滚动脚本，让它在结束后自动触发提取脚本。在控制台中输入以下需要**手动键入的命令**：
    ```
    autoScrollToBottom(extractAndDownloadAllChapters);
    ```
    这种方式更为连贯，但需要确保两个函数都已正确定义。

---

希望这份详细的说明能帮助你顺利使用这些工具！
